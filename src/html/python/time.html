<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <!-- HTML 4 -->
	<meta charset="UTF-8">                                              <!-- HTML 5 -->
	<title>Time In Python | JEHTech</title>
	<!-- META_INSERT -->
	<!-- CSS_INSERT -->
	<!-- JAVASCRIPT_INSERT -->
</head>

<body>
<div id="header">
	-- This is JEHTech --
</div>

<div id="sidebar">
	<h1 class="title">Links...</h1>
	<div id="includedContent"></div>
</div>

<div id="content">
<h1 class="title">Dates And Time In Python</h1>
<div style="padding-right:10px;">

<h2>Page Contents</h2>
<div id="page_contents">
</div>

<h2>References</h2>
<div>
<ul>
   <li><a href="https://www.w3.org/TR/timezone/" target="_blank">Working with Time Zones</a>, WC3.</li>
   <li><a href="http://www.allanstime.com/Publications/DWA/Science_Timekeeping/TheScienceOfTimekeeping.pdf"
   	      target="_blank">The Science of Timekeeping</a>, HP.</li>
   <li><a href="https://julien.danjou.info/blog/2015/python-and-timezones" target="_blank">Timezones and Python </a>,  
   	   Julien Danjou.</li>
   <li><a href="http://lucumr.pocoo.org/2011/7/15/eppur-si-muove/" target="_blank">Dealing with Timezones in Python</a>, 
   	   Armin Ronacher.</li>
   <li><a href="https://regebro.wordpress.com/2007/12/18/python-and-time-zones-fighting-the-beast/" target="_blank">Problems with Python and timezones</a>,
   	   Lennart Regebro</li>
</ul>
</div>

<h2>Introduction</h2>
<div>
	<p>
		The referenced article, &quot;The Science Of Timekeeping&quot;, gives a really nice introduction
		to time and the history of how we measure time. Combined with the reference WC3 article we can get
		an idea of how our concept of time originated from observable phenomena like sunrise and sunset,
		the seasons etc, and how now it is based on more abstract standards like the <q>the transition between
		the two hyperfine levels of the ground state of the cesium-133 atom</q>.
	</p>
	<p>
		All of this is important for us to realise that there is no really universal definition of time that is
		the same all over the world, except for something called UTC.
	</p>
	<p>
		Countries have their own timezones, not all of which differ in a regular pattern, where daylight saving
		time (DST) may be active or not depending on the time of year, and worse, there are crazy things like 
		leap days end even leap seconds!
	</p>
	<blockquote>
		<p>
			In 1884, ... the Greenwich observatory was accepted as source of the
			worldâ€™s standard time ...
		</p><p>
			... GMT has evolved to UTC ... GMT was based on mean solar time. UTC is based on a
			definition of the second that is nearly a million times more accurate ... based
			on a quantum resonance within a caesium atom ...
		</p><p>
			... UTC is established by the Bureau International des Poids et Mesures (BIPM) based on an a
			aggregate of data from timing laboratories throughout the world, and from
			input from the International Earth Rotation Service (IERS).
		</p>
		<footer>
			<a href="http://www.allanstime.com/Publications/DWA/Science_Timekeeping/TheScienceOfTimekeeping.pdf"
   	           target="_blank">The Science of Timekeeping</a>, HP.
		</footer>
	</blockquote>
	<p>
		&quot;Computerphile&quot; gives a really good summary:
	</p>
	<iframe width="560" height="315" src="https://www.youtube.com/embed/-5wpm-gesOY" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
	<p></p>
</div>

<h2>Time Standards</h2>
<div>
	<p>Note that these are NOT time zones!
	</p>
	<h3>Solar Time</h3>
	<div>
		<ul>
			<li>Time set based on the local position of the sun.</li>
			<li>E.g. sundial time.</li>
			<li>Day lengths vary depending on season - effects accumulate.</li>
		</ul>
	</div>

	<h3>UT1</h3>
	<div>
		<ul>
			<li>Based on the Earth's rotation, from which the mean solar day is derived.</li>
			<li>Modern continuation of GMT.</li>
		</ul>
	</div>

	<h3>TAI</h3>
	<div>
		<ul>
			<li>Atomic clock based standard based on the average of hundres of atmoic clocks throught the world.</li>
			<li>Basis for UTC.</li>
			<li>Never adjusted and always continuous. I.e., no leap seconds.</li>
		</ul>
	</div>

	<h3>UTC</h3>
	<div>
		<ul>
			<li>Based on TAI with leap seconds added to keep it within 0.9 seconds of UT1.</li>
			<li>Modified to be related to UT1 using leap seconds. UTC ticks with the same frequency as TAI - very accurate and stable - but is phase aligned in jumps of leap-seconds to UT1</li>
			<li>Related to UT1 so that the &quot;wall clock&quot; relates to the human day - i.e., when it is day and night.</li>
			<li>Not continuous because of leap seconds.</li>
		</ul>
	</div>

	<h3>Unix Epoch</h3>
	<div>
		<ul>
			<li>A.k.a. just the &quot;Epoch&quot;.</li>
			<li>Seconds elapsed since 00:00:00 UTC on January 1, 1970</li>
		</ul>
	</div>
</div>

<h2>Time Zones & Daylight Saving Hours</h2>
<div>
	<p>
		The world uses UTC. By agreement we've all said we'll use UTC to agree on the same standard of time. The added complexity to the
		mix is time zones. At a UTC time of X in some parts of the world it will be day and in others it will be night, so in regions
		of the world the UTC time is offset so that 12pm is roughly what we would perceive as midday in terms of sun position.
	</p>
	<p>
		For historical reasons UTC+0 is GMT - the mean solar time at the Royal Observatory in Greenwich. The following is an image
		of the world timezones as <a href="https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/World_Time_Zones_Map.png/1920px-World_Time_Zones_Map.png" target="_blank">found on Wikipedia</a>.
	</p>
	<p>
		<img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/88/World_Time_Zones_Map.png/1920px-World_Time_Zones_Map.png" style="width:75%;"/>
	</p>
	<p>
		From the above, we can see that if we lived in, for example, Malta, we would use UTC+1 as our time base. We can also
		see that timezones are as much political as they are geographic.
	</p>
	<p>
		To make life even more complicated there are daylight saving hours to consider. In countries where the potion of the dat
		that is light moves depending on season an offset of +/- 1 hour (or fractional or multiple) can be applied to the time. This
		is purely a human thing so that we get more of the &quot;day&quot; time in the light!
	</p>
	<p>
		Figuring out your machine's local time zone can be <a href="https://regebro.wordpress.com/2008/05/13/thanks-for-the-testing-help-conclusions/" target="_blank">suprisingly difficult</a>. The same authot's first blog about the <a href="https://regebro.wordpress.com/2007/12/18/python-and-time-zones-fighting-the-beast/" target="_blank">problems with Python and timezones</a> is a good read too.
	</p>
	<p>
		Of particular note is the <a href="https://en.wikipedia.org/wiki/Tz_database" target="_blanK">TZ Database</a>.
	</p>
</div>

<h2>Using Dates &amp; Times in Python</h2>
<div>
	<p>The referenced articles by Julien Danjou and Armin Ronacher both make the following very poinient point: Python 
	   <code>datetime</code> objects, by default are <em>not</em> timezone aware!. This can be read directly from
	   the Python docs, but wasn't something I'd taken enough notice of until reading those articles!
	</p>
	<blockquote>
		<p>
			An aware object has sufficient knowledge of applicable algorithmic and political time adjustments, such as 
			time zone and daylight saving time information, to locate itself relative to other aware objects. An aware
			object is used to <em>represent a specific moment in time that is not open to interpretation</em>.
		</p>
		<p>...</p>
		<p>For applications requiring aware objects, datetime and time objects have an optional time zone information 
		   attribute, <code>tzinfo</code>, that can be set to an instance of a subclass of the abstract tzinfo class. 
		   These <code>tzinfo</code> 
		   objects capture information about the offset from UTC time, the time zone name, and whether Daylight Saving 
		   Time is in effect.
		</p>
		<footer>
			-- <a href="https://docs.python.org/3/library/datetime.html" target="_blank">Python docs</a>. (Emphasis mine).
		</footer>
	</blockquote>
	<p>
		Thus, when using dates/time in Python <b>always use aware objects</b> so that there is no ambiguity in
		what time is being represented and <b>always store time in UTC</b>: An aware current UTC datetime can 
		be obtained by calling <code>datetime.now(pytz.utc)</code>. Why do we want to do this? As Danjou points
		out, without this the <code>datetime</code> object will have no timezone information, so later on in the
		code, can we be sure it is representing a time in UTC? There would be no way to tell! He suggests
		treating any <code>datetime</code> without a timezone as a bug!
	</p>
	<div class="box_container">
		<div class="warning">
			<p>Never use unware <code>datetime</code> objects. Always make sure you get timezone aware objects
			and even better objects using UTC with the timezone information set to UTC: 
			<code>datetime.now(pytz.utc)</code>!</p>
		</div>
	</div>
	<p>
		As Danjou recommends, as well as using aware <code>datetime</code> objects you should also
		store and retreive dates/times in 
		<a href="https://en.wikipedia.org/wiki/ISO_8601" target="_blank">ISO 8601</a> format by using <code>datetime.datetime.isoformat()</code>.
	</p>
	<div class="box_container">
		<div class="info">
			<p>To store and retreive date/time use ISO 8601 format, supported by the Python <code>iso8601</code> 
			package.</p>
		</div>
	</div>
	<p></p>
</div>

<h2>Examples</h2>
<div>
	<h3>Get The Current Time as UTC</h3>
	<pre class="prettyprint linenums">&gt;&gt;&gt; import datetime
&gt;&gt;&gt; import pytz
&gt;&gt;&gt; datetime.datetime.now(pytz.utc)
datetime.datetime(2018, 3, 18, 12, 36, 52, 315868, tzinfo=&lt;UTC&gt;)</pre>

	<h3>Output Current Time In ISO 8601 Format</h3>
	<pre class="prettyprint linenums">&gt;&gt;&gt; import datetime
&gt;&gt;&gt; import pytz
&gt;&gt;&gt; datetime.datetime.now(pytz.utc).isoformat()
'2018-03-18T12:41:07.591469+00:00'</pre>

	<h3>Input Current Time In ISO 8601 Format</h3>
	<pre class="prettyprint linenums">&gt;&gt;&gt; import datetime
&gt;&gt;&gt; import pytz
&gt;&gt;&gt; import iso8601
&gt;&gt;&gt; a = datetime.datetime.now(pytz.utc).isoformat()
&gt;&gt;&gt; a
'2018-03-19T07:53:48.225000+00:00'
&gt;&gt;&gt; iso8601.parse_date(a)
datetime.datetime(2018, 3, 19, 7, 53, 48, 225000, tzinfo=&lt;FixedOffset '+00:00' datetime.timedelta(0)&gt;)</pre>

	<h3>Convert Local Time To UTC</h3>
	<div>
		<p>
			Copied verbatim from this <a href="https://stackoverflow.com/a/79877/1517244" target="_blank">SO answer</a>.
		</p>
		<pre class="prettyprint linenums">import pytz, datetime
local = pytz.timezone ("America/Los_Angeles") # See the <a href="https://en.wikipedia.org/wiki/Tz_database" target="_blanK">TZ Database</a>...
naive = datetime.datetime.strptime ("2001-2-3 10:11:12", "%Y-%m-%d %H:%M:%S")
local_dt = local.localize(naive, is_dst=None)
utc_dt = local_dt.astimezone(pytz.utc)
utc_dt.strftime ("%Y-%m-%d %H:%M:%S")</pre>
	</div>

	<h3>Convert DateTime To Epoch</h3>
	<p>Summarised from <a href="https://stackoverflow.com/a/11743262/1517244" target="_blank">here</a>.
	<pre class="prettyprint linenums">(datetime.datetime(year,month,day[,hours[,mins[,secs[,usecs[,tzinfo]]]]]) - datetime.datetime(1970,1,1)).total_seconds() # Py 2
datetime.datetime(year,month,day[,hours[,mins[,secs[,usecs[,tzinfo]]]]]).strftime('%s') # Py 3</pre>
<p></p>
</div>

</div> <!-- End padding div -->
</div> <!-- End content div -->

</body>
</html>


